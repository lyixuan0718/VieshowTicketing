<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»æ•¸å…Œæ›ä¸­å¿ƒ - Vieshow Ticketing</title>
    
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vieshow-red': '#e50914',
                        'vieshow-gold': '#f7a83d',
                        'vieshow-bg': '#fefefe', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans min-h-screen flex flex-col">
    
    <!-- Header å°èˆª (æ¨¡æ“¬) -->
    <header class="bg-gray-800 text-white shadow-md">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <!-- å‡è¨­å¾ pages/points å°èˆªåˆ°æ ¹ç›®éŒ„ (../../index.html) -->
            <a href="../../index.html" class="text-xl font-bold hover:text-vieshow-red transition duration-300">Vieshow å½±åŸ</a>
            <div class="space-x-4 flex items-center">
                <!-- ä¿®æ­£ï¼šå¾ pages/points å°èˆªåˆ° pages/member/member_home.html -->
                <a href="../member/member_home.html" class="text-sm font-medium hover:text-vieshow-gold transition duration-300">ğŸ‘¤ æœƒå“¡ä¸­å¿ƒ</a>
                <button id="signOutButton" class="bg-vieshow-red px-3 py-1 rounded-full text-white text-sm font-semibold hover:bg-red-700 transition duration-300">
                    ç™»å‡º
                </button>
            </div>
        </nav>
    </header>

    <div class="container mx-auto px-4 py-10 flex-grow max-w-4xl">
        
        <div class="bg-vieshow-bg p-6 sm:p-8 rounded-xl shadow-2xl border-t-4 border-vieshow-gold">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-2 flex items-center justify-center">
                ğŸ é»æ•¸å…Œæ›ä¸­å¿ƒ
            </h2>
            <p class="text-center text-gray-500 mb-8">ä½¿ç”¨æ‚¨çš„ iShow é»æ•¸å…Œæ›ç²¾é¸å•†å“åŠå„ªæƒ åˆ¸ã€‚</p>

            <!-- é»æ•¸è³‡è¨Šèˆ‡å…Œæ›è¨˜éŒ„é€£çµ -->
            <div class="flex flex-col sm:flex-row justify-between items-center bg-gray-50 p-4 rounded-lg border border-gray-200 mb-8 shadow-inner">
                <div class="text-center sm:text-left mb-3 sm:mb-0">
                    <p class="text-lg font-medium text-gray-700">æ‚¨çš„ç•¶å‰å¯ç”¨é»æ•¸:</p>
                    <p class="text-3xl font-extrabold text-vieshow-red mt-1" id="currentPoints">1,350 é»</p>
                </div>
                <!-- ä¿®æ­£ï¼šé€£çµåˆ° point_history.html (å‡è¨­åœ¨åŒä¸€ç›®éŒ„ pages/points ä¸‹) -->
                <a href="point_history.html" class="text-vieshow-red hover:text-vieshow-gold font-semibold transition duration-150 text-sm">
                    æŸ¥çœ‹æˆ‘çš„å…Œæ›è¨˜éŒ„ &rarr;
                </a>
            </div>

            <!-- å…Œæ›å•†å“æ¸…å–® (Product List) -->
            <h3 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">ç²¾é¸å…Œæ›å“é …</h3>
            
            <div id="productGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- å•†å“å¡ç‰‡ç¯„ä¾‹ 1: çˆ†ç±³èŠ±å¥—é¤ -->
                <div class="exchange-card bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden border border-gray-100" data-id="popcorn" data-cost="500">
                    <div class="p-4 sm:p-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">ğŸ¿ ç¶“å…¸å¤§çˆ†ç±³èŠ±å¥—é¤</h4>
                        <p class="text-gray-500 text-sm mb-4">ä¸€ä»½å¤§çˆ†ç±³èŠ±èˆ‡å…©æ¯ä¸­æ¯é£²æ–™ï¼Œè§€å½±å¿…å‚™ï¼</p>
                        <div class="text-center bg-vieshow-red text-white py-2 rounded-lg font-extrabold text-2xl mb-4">
                            500 é»
                        </div>
                        <button class="exchange-button w-full bg-vieshow-gold text-gray-900 py-2 rounded-lg font-bold hover:bg-yellow-600 transition duration-150">
                            ç«‹å³å…Œæ›
                        </button>
                        <p class="text-xs text-center text-gray-400 mt-2">é»æ“Šå…Œæ›å°‡ç”Ÿæˆå…Œæ›æ¢ç¢¼</p>
                    </div>
                </div>

                <!-- å•†å“å¡ç‰‡ç¯„ä¾‹ 2: ä¸­æ¯é£²æ–™ -->
                <div class="exchange-card bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden border border-gray-100" data-id="drink" data-cost="200">
                    <div class="p-4 sm:p-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">ğŸ¥¤ ä»»é¸ä¸­æ¯é£²æ–™</h4>
                        <p class="text-gray-500 text-sm mb-4">å¯å…Œæ›ä¸€æ¯ä¸­æ¯å¯æ¨‚æˆ–æ°£æ°´ã€‚</p>
                        <div class="text-center bg-vieshow-red text-white py-2 rounded-lg font-extrabold text-2xl mb-4">
                            200 é»
                        </div>
                        <button class="exchange-button w-full bg-vieshow-gold text-gray-900 py-2 rounded-lg font-bold hover:bg-yellow-600 transition duration-150">
                            ç«‹å³å…Œæ›
                        </button>
                        <p class="text-xs text-center text-gray-400 mt-2">é»æ“Šå…Œæ›å°‡ç”Ÿæˆå…Œæ›æ¢ç¢¼</p>
                    </div>
                </div>
                
                <!-- å•†å“å¡ç‰‡ç¯„ä¾‹ 3: 50å…ƒæŠµç”¨åˆ¸ (é»æ•¸ä¸è¶³æ¨¡æ“¬) -->
                <div class="exchange-card bg-white rounded-xl shadow-lg transition duration-300 overflow-hidden border border-gray-100 opacity-60" data-id="coupon" data-cost="1500">
                    <div class="p-4 sm:p-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">ğŸ·ï¸ 50å…ƒé›»å½±æŠµç”¨åˆ¸</h4>
                        <p class="text-gray-500 text-sm mb-4">å–®ç­†è³¼ç¥¨æŠ˜æŠµ 50 å…ƒï¼Œä½¿ç”¨æœŸé™ä¸‰å€‹æœˆã€‚</p>
                        <div class="text-center bg-gray-500 text-white py-2 rounded-lg font-extrabold text-2xl mb-4">
                            1,500 é»
                        </div>
                        <button class="exchange-button w-full bg-gray-400 text-white py-2 rounded-lg font-bold cursor-not-allowed" disabled>
                            é»æ•¸ä¸è¶³
                        </button>
                        <p class="text-xs text-center text-gray-400 mt-2">éœ€ 1,500 é»ï¼Œç›®å‰ä¸è¶³</p>
                    </div>
                </div>

            </div>
            
            <!-- å…Œæ›ç¢ºèªå½ˆçª— (Modal) -->
            <div id="exchangeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50" onclick="closeModal(event)">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
                    <h3 class="text-2xl font-bold text-vieshow-red mb-4">å…Œæ›ç¢ºèª</h3>
                    <p class="text-lg text-gray-700 mb-2">æ‚¨å³å°‡ä½¿ç”¨ <span id="modalCost" class="font-extrabold text-vieshow-red"></span> é»å…Œæ›ï¼š</p>
                    <p id="modalProduct" class="text-xl font-semibold text-gray-900 border-b pb-3 mb-4"></p>
                    
                    <div id="modalMessage" class="hidden p-3 my-4 rounded-lg font-medium text-sm text-center"></div>

                    <p class="text-sm text-gray-500 mb-6">å…Œæ›æˆåŠŸå¾Œï¼Œé»æ•¸å°‡ç«‹å³æ‰£é™¤ï¼Œå…Œæ›ç¢¼å°‡å­˜æ–¼æ‚¨çš„ã€Œæˆ‘çš„å…Œæ›è¨˜éŒ„ã€ã€‚</p>

                    <div class="flex justify-end space-x-3">
                        <button id="cancelButton" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-150 font-medium">
                            å–æ¶ˆ
                        </button>
                        <button id="confirmButton" class="px-6 py-2 text-white bg-vieshow-red rounded-lg hover:bg-red-700 transition duration-150 font-bold">
                            ç¢ºèªå…Œæ›
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- JavaScript é‚è¼¯ -->
    <script>
        const currentPointsDisplay = document.getElementById('currentPoints');
        const exchangeButtons = document.querySelectorAll('.exchange-button');
        const exchangeModal = document.getElementById('exchangeModal');
        const modalProduct = document.getElementById('modalProduct');
        const modalCost = document.getElementById('modalCost');
        const modalMessage = document.getElementById('modalMessage');
        const confirmButton = document.getElementById('confirmButton');
        const cancelButton = document.getElementById('cancelButton');
        
        // æ¨¡æ“¬æœƒå“¡ç•¶å‰é»æ•¸
        let currentPoints = 1350; 
        currentPointsDisplay.textContent = `${currentPoints.toLocaleString()} é»`;

        let selectedItem = null; // å„²å­˜ç•¶å‰é»æ“Šçš„å•†å“è³‡æ–™

        // --- è¨Šæ¯è™•ç†å‡½æ•¸ (ç”¨æ–¼å½ˆçª—å…§) ---
        function showModalMessage(text, type) {
            modalMessage.textContent = text;
            modalMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            
            if (type === 'success') {
                modalMessage.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                modalMessage.classList.add('bg-red-100', 'text-red-800');
            }
            modalMessage.classList.remove('hidden');
        }

        // --- é–‹å•Ÿå½ˆçª— ---
        function openModal(productName, cost, id) {
            selectedItem = { productName, cost, id };
            
            modalProduct.textContent = productName;
            modalCost.textContent = cost.toLocaleString();
            modalMessage.classList.add('hidden'); // æ¸…é™¤èˆŠè¨Šæ¯
            
            confirmButton.disabled = false;
            confirmButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
            confirmButton.textContent = 'ç¢ºèªå…Œæ›';

            exchangeModal.classList.add('flex');
            exchangeModal.classList.remove('hidden');
        }

        // --- é—œé–‰å½ˆçª— ---
        function closeModal(event) {
            if (event.target === exchangeModal || event.target === cancelButton) {
                exchangeModal.classList.add('hidden');
                exchangeModal.classList.remove('flex');
                selectedItem = null;
            }
        }
        
        // å°‡é—œé–‰äº‹ä»¶ç¶å®šåˆ°å–æ¶ˆæŒ‰éˆ•
        cancelButton.addEventListener('click', closeModal);

        // --- è™•ç†å…Œæ›æŒ‰éˆ•é»æ“Šäº‹ä»¶ ---
        exchangeButtons.forEach(button => {
            const card = button.closest('.exchange-card');
            const cost = parseInt(card.dataset.cost);
            const id = card.dataset.id;
            const productName = card.querySelector('h4').textContent.trim();
            
            if (cost > currentPoints) {
                // å¦‚æœé»æ•¸ä¸è¶³ï¼ŒæŒ‰éˆ•å·²ç¶“åœ¨ HTML ä¸­è¢«ç¦ç”¨ï¼Œé€™è£¡ä¸éœ€è¦é¡å¤–è™•ç†
                return; 
            }

            button.addEventListener('click', () => {
                openModal(productName, cost, id);
            });
        });

        // --- ç¢ºèªå…Œæ›é‚è¼¯ ---
        confirmButton.addEventListener('click', () => {
            if (!selectedItem || confirmButton.disabled) return;

            const { productName, cost, id } = selectedItem;

            if (currentPoints < cost) {
                showModalMessage('é»æ•¸ä¸è¶³ï¼Œç„¡æ³•å®Œæˆå…Œæ›ã€‚', 'error');
                return;
            }
            
            // æ¨¡æ“¬ API å‘¼å«é€²è¡Œå…Œæ›
            confirmButton.disabled = true;
            confirmButton.textContent = 'è™•ç†ä¸­...';
            confirmButton.classList.add('bg-gray-400', 'cursor-not-allowed');

            setTimeout(() => {
                // å‡è¨­å…Œæ›æˆåŠŸ
                currentPoints -= cost;
                
                // æ›´æ–° UI é»æ•¸é¡¯ç¤º
                currentPointsDisplay.textContent = `${currentPoints.toLocaleString()} é»`;

                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                showModalMessage(`âœ… æˆåŠŸå…Œæ› ${productName}ï¼å·²æ‰£é™¤ ${cost} é»ã€‚`, 'success');
                
                // ç¦ç”¨å…Œæ›æŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡æäº¤
                confirmButton.textContent = 'å…Œæ›å®Œæˆ';
                
                // æ›´æ–°å•†å“æ¸…å–®ä¸­çš„æŒ‰éˆ•ç‹€æ…‹
                updateExchangeButtonsState();

            }, 2000);
        });

        // --- æ›´æ–°å•†å“æ¸…å–®ä¸­æŒ‰éˆ•ç‹€æ…‹ (ç”¨æ–¼å…Œæ›å¾Œ) ---
        function updateExchangeButtonsState() {
            document.querySelectorAll('.exchange-card').forEach(card => {
                const button = card.querySelector('.exchange-button');
                const cost = parseInt(card.dataset.cost);

                if (cost > currentPoints) {
                    // é»æ•¸ä¸è¶³
                    card.classList.add('opacity-60');
                    button.disabled = true;
                    button.textContent = 'é»æ•¸ä¸è¶³';
                    button.classList.add('bg-gray-400', 'cursor-not-allowed');
                    button.classList.remove('bg-vieshow-gold', 'hover:bg-yellow-600');
                    card.querySelector('.text-xs').textContent = `éœ€ ${cost.toLocaleString()} é»ï¼Œç›®å‰ä¸è¶³`;
                } else {
                    // é»æ•¸è¶³å¤ 
                    card.classList.remove('opacity-60');
                    button.disabled = false;
                    button.textContent = 'ç«‹å³å…Œæ›';
                    button.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    button.classList.add('bg-vieshow-gold', 'hover:bg-yellow-600');
                    card.querySelector('.text-xs').textContent = 'é»æ“Šå…Œæ›å°‡ç”Ÿæˆå…Œæ›æ¢ç¢¼';
                }
            });
        }
        
        // åˆå§‹åŒ–æ™‚æª¢æŸ¥æ‰€æœ‰å•†å“çš„å…Œæ›ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', updateExchangeButtonsState);
    </script>
    
</body>
</html>