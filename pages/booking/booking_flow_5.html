<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚ç¥¨æ­¥é©Ÿ 5: é¸æ“‡ä»˜æ¬¾æ–¹å¼ - Vieshow Ticketing</title> 
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="antialiased">

<!-- Header -->
<header class="bg-gray-800 text-white shadow-md">
    <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
        <a href="../../index.html" class="text-xl font-bold hover:text-red-400 transition">Vieshow å½±åŸ</a>
        <div class="space-x-4">
            <a href="../auth/login.html" class="hover:text-yellow-300 transition">ç™»å…¥</a>
            <a href="../member/member_home.html" class="hover:text-yellow-300 transition">æœƒå“¡ä¸­å¿ƒ</a>
        </div>
    </nav>
</header>

<!-- Main Container -->
<div class="w-11/12 md:max-w-2xl mx-auto my-8 p-6 bg-white border border-gray-200 rounded-xl shadow-2xl">

    <h2 class="text-2xl font-extrabold text-gray-900 mb-6 flex items-center">
        ğŸ’³ è¨‚ç¥¨æµç¨‹ - æ­¥é©Ÿ 5/7 (é¸æ“‡ä»˜æ¬¾æ–¹å¼)
    </h2>

    <p class="text-gray-700 mb-4">
        è«‹é¸æ“‡æ‚¨åå¥½çš„ä»˜æ¬¾æ–¹å¼ä¸¦ç¢ºèªæ‡‰ä»˜é‡‘é¡ã€‚
    </p>
    
    <form id="paymentForm" class="space-y-6">

        <!-- ä»˜æ¬¾æ–¹å¼ -->
        <div>
            <h3 class="text-lg font-semibold mb-2">ä»˜æ¬¾æ–¹å¼</h3>

            <label class="block mb-2">
                <input type="radio" name="payment_method" value="credit_card" checked>
                ä¿¡ç”¨å¡ / é‡‘èå¡ (VISAã€MasterCardã€JCB)
            </label>

            <label class="block mb-2">
                <input type="radio" name="payment_method" value="line_pay">
                Line Pay (æ‰‹æ©Ÿå¿«é€Ÿä»˜æ¬¾)
            </label>
        </div>

        <!-- æ‡‰ä»˜ç¸½é‡‘é¡ -->
        <div class="border-t pt-4">
            <h3 class="text-lg font-semibold text-red-600">
                æœ¬æ¬¡æ‡‰ä»˜é‡‘é¡ï¼šNT$ <span id="displayTotalAmount">0</span>
            </h3>
        </div>

        <!-- æ³¨æ„äº‹é … -->
        <div>
            <h3 class="text-lg font-semibold mb-2">æ³¨æ„äº‹é …</h3>
            <textarea readonly class="w-full border p-2 rounded" rows="5">
é€€ç¥¨é ˆåœ¨é›»å½±é–‹æ¼”å‰ 30 åˆ†é˜å®Œæˆï¼Œé€¾æ™‚ä¸äºˆå—ç†ã€‚
ç·šä¸Šäº¤æ˜“å…¨ç¨‹æ¡ç”¨ SSL åŠ å¯†ï¼Œç¢ºä¿ä»˜æ¬¾è³‡è¨Šå®‰å…¨ã€‚
æœ¬ç³»çµ±ç›®å‰æ”¯æ´ä¿¡ç”¨å¡èˆ‡ Line Payã€‚
            </textarea>
        </div>

        <!-- ä¸‹ä¸€æ­¥ -->
        <button type="submit"
                class="w-full py-3 bg-red-700 text-white rounded-xl font-bold text-lg hover:bg-red-800 transition">
            ä¸‹ä¸€æ­¥ï¼šå¡«å¯«ä»˜æ¬¾è³‡è¨Š (æ­¥é©Ÿ 6)
        </button>
    </form>

    <!-- è¿”å› -->
    <p class="mt-4 text-center">
        <a href="#" id="backLink" class="text-red-600 hover:text-red-800">
            â† è¿”å›ä¸Šä¸€æ­¥ï¼ˆè¨‚å–®ç¢ºèªï¼‰
        </a>
    </p>
</div>

<!-- JS -->
<script>
    // å®‰å…¨å°é ï¼ˆé¿å… Blob URL ç„¡æ³•è·³è½‰ï¼‰
    function safeNavigate(file) {
        try { window.location.href = file; }
        catch (e) {
            const current = window.location.href;
            const dir = current.substring(0, current.lastIndexOf('/') + 1);
            window.location.href = dir + file;
        }
    }

    let currentBooking = {};

    function loadBookingData() {
        const stored = localStorage.getItem("currentBooking");

        if (!stored) {
            console.warn("âš  æ²’æ‰¾åˆ° currentBookingï¼Œå›åˆ°æ­¥é©Ÿ 4");
            safeNavigate("booking_flow_4.html");
            return;
        }

        try {
            currentBooking = JSON.parse(stored);
        } catch (err) {
            console.error("JSON è§£æéŒ¯èª¤:", err);
            safeNavigate("booking_flow_4.html");
            return;
        }

        // ç¢ºä¿ç¸½é‡‘é¡å­˜åœ¨
        if (!currentBooking.totalPrice) {
            console.error("ç¼ºå°‘ totalPriceï¼Œå›åˆ°æ­¥é©Ÿ 4");
            safeNavigate("booking_flow_4.html");
            return;
        }

        // é¡¯ç¤ºé‡‘é¡
        document.getElementById("displayTotalAmount").textContent = currentBooking.totalPrice;

        // è‹¥ä½¿ç”¨è€…ä¹‹å‰é¸éä»˜æ¬¾æ–¹å¼ï¼Œé é¸
        if (currentBooking.payment_method) {
            const radio = document.querySelector(`input[name="payment_method"][value="${currentBooking.payment_method}"]`);
            if (radio) radio.checked = true;
        }
    }

    // è¡¨å–®é€å‡ºï¼ˆä¸‹ä¸€æ­¥ï¼‰
    document.getElementById("paymentForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const selected = document.querySelector('input[name="payment_method"]:checked');
        if (!selected) {
            alert("è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼");
            return;
        }

        currentBooking.payment_method = selected.value;
        localStorage.setItem("currentBooking", JSON.stringify(currentBooking));

        safeNavigate("booking_flow_6.html");
    });

    // è¿”å›
    document.getElementById("backLink").addEventListener("click", function (event) {
        event.preventDefault();
        safeNavigate("booking_flow_4.html");
    });

    loadBookingData();
</script>

<footer class="bg-gray-800 text-white text-center py-4 mt-8 shadow-inner">
    <p>&copy; 2025 Vieshow Ticketing System</p>
</footer>

</body>
</html>
